{% extends 'base.html' %}
{% block title %}Shared Folder - MITS Portal{% endblock %}
{% block content %}
<div class="max-w-6xl mx-auto">
  <div class="bg-white rounded-xl shadow-lg overflow-hidden">
    <!-- Header -->
    <div class="bg-gradient-to-r from-primary to-blue-700 text-white p-6">
      <div class="flex items-center gap-4">
        <div class="w-16 h-16 bg-white bg-opacity-20 rounded-lg flex items-center justify-center">
          <span class="text-2xl">üìÅ</span>
        </div>
        <div>
          <h1 class="text-2xl font-bold">{{ folder_name }}</h1>
          <p class="text-blue-100">Shared by {{ created_by.username }}</p>
          <p class="text-blue-200 text-sm">{{ created_at|date:"M d, Y" }}</p>
        </div>
      </div>
    </div>

    <!-- Content -->
    <div class="p-6">
      <!-- Folder Info -->
      <div class="grid md:grid-cols-3 gap-6 mb-6">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Folder Name</label>
          <p class="text-gray-900 font-medium">{{ folder_name }}</p>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Shared By</label>
          <p class="text-gray-900">{{ created_by.username }}</p>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Share Type</label>
          <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
            {% if share_type == 'public' %}bg-green-100 text-green-800
            {% elif share_type == 'email' %}bg-blue-100 text-blue-800
            {% elif share_type == 'password' %}bg-yellow-100 text-yellow-800
            {% endif %}">
            {{ share_type|title }}
          </span>
        </div>
      </div>

      <!-- Folder Contents -->
      <div class="mb-6">
        <h3 class="text-lg font-medium text-gray-900 mb-4">Folder Contents</h3>
        <div id="folder-contents" class="space-y-2">
          <!-- Contents will be populated by JavaScript -->
        </div>
      </div>

      <!-- Share Info -->
      <div class="p-4 bg-gray-50 rounded-lg">
        <h3 class="text-sm font-medium text-gray-700 mb-2">Share Information</h3>
        <p class="text-sm text-gray-600">
          This folder was shared from MITS Portal. You can download individual files by clicking on them.
          If you have any questions about this folder, please contact {{ created_by.username }}.
        </p>
      </div>
    </div>
  </div>
</div>

<script>
// Render folder contents
function renderFolderContents(contents, level = 0) {
  let html = '';
  
  // Render files
  if (contents.files && contents.files.length > 0) {
    contents.files.forEach(file => {
      html += `
        <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg ml-${level * 4}">
          <div class="w-8 h-8 bg-blue-100 text-blue-600 rounded flex items-center justify-center text-sm font-medium">
            ${file.file_extension || '?'}
          </div>
          <div class="flex-1">
            <div class="font-medium text-gray-900">${file.name}</div>
            <div class="text-sm text-gray-500">${file.file_size}</div>
          </div>
          <a href="${file.file_url}" download="${file.name}" 
             class="px-3 py-1 bg-primary text-white text-sm rounded hover:bg-blue-700 transition-colors">
            Download
          </a>
        </div>
      `;
    });
  }
  
  // Render subfolders
  if (contents.children && contents.children.length > 0) {
    contents.children.forEach(child => {
      html += `
        <div class="ml-${level * 4}">
          <div class="flex items-center gap-3 p-3 bg-amber-50 rounded-lg mb-2">
            <div class="w-8 h-8 bg-amber-100 text-amber-600 rounded flex items-center justify-center">
              üìÅ
            </div>
            <div class="flex-1">
              <div class="font-medium text-gray-900">${child.name}</div>
              <div class="text-sm text-gray-500">${child.files.length} files</div>
            </div>
          </div>
          ${renderFolderContents(child, level + 1)}
        </div>
      `;
    });
  }
  
  return html;
}

// Initialize folder contents
document.addEventListener('DOMContentLoaded', function() {
  const folderContents = {{ folder_contents|safe }};
  const container = document.getElementById('folder-contents');
  container.innerHTML = renderFolderContents(folderContents);
});
</script>
{% endblock %}
